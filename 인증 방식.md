# Token인증 vs Server인증

---

## 1. 서버 기반 인증

Token이 쓰이기 이전 기존 인증 방식이다. **서버 측에서 사용자들의 정보를 기억**하고 있어야 한다는 특징이 있고, 이는 **사용자들의 정보를 기억하기 위해서는 세션을 유지**해야 한다.(주로 메모리, 디스크, 데이터베이스를 이용함)

세션을 유지하는 방법은 서버는 클라이언트의 요청을 받으면 클라이언트의 상태를 유지시키고 이를 서비스에 이용한다.(EX)로그인 상태 유지) 이러한 서버들을 Sateful이라고 한다.

<img width="665" alt="스크린샷 2020-11-13 오후 11 45 17" src="https://user-images.githubusercontent.com/64365001/99094566-552c4500-2617-11eb-9dd8-be55f01198b0.png">

위 사진은 세션 인증에서의 서버와 클라이언트의 흐름이다.(출처 : 망나니개발자님의 게시물)

그러나 위와같은 방식에는 소규모 시스템에서는 문제가 없지만 웹/앱이 발전함에 따라 다음의 문제가 발견되었다.

### 세션 인증의 단점

1. 세션 : 사용자가 인증을 할때, 서버는 이러한 정보를 저장해야 하고 이를 세션(Session)이라부른다. 세션을 주로 메모리에 저장하지만 로그인중인 유저가 늘어날 경우 서버의 메모리가 버티지 못한다. 때문에 데이터베이스를 이용하지만 이도 부하가 크다.
2. 확장성 : 사용자가 늘어나게 되면 더 많은 트래픽을 처리하기 위해 여러 프로세스를 돌리거나 컴퓨터를 추가하는 등 서버를 확장하게 되면 세션을 사용하는 서버는 세션을 분산시키는 시스템을 만들지만 이는 매우 어렵다.
3. CORS(Cross Origin Resource Sharing) : 웹 어플리케이션에서 세션을 관리할 때 자주 사용되는 쿠키는 단일 도메인 및 서브 도메인에서만 작동하도록 설계되어있다. 따라서 쿠키를 여러 도메인에서 관리하는 것이 까다롭다.

---

## 2. 토큰 기반의 인증 시스템

토큰 기반의 인증 시스템은 **인증받은 사용자들에게 토큰을 발급하고, 서버에 용청을 할 때 헤더에 토큰을 함께 보내도록 하여 유효성 검사**를 한다. 이 방식은 클라이언트 측에서 들어오는 요청만으로 작업을 처리하나. 즉, 서버처럼 **상태를 유지하지 않으므로 Stateless한 구조**를 가지게 된다.

<img width="665" alt="스크린샷 2020-11-14 오전 12 10 43" src="https://user-images.githubusercontent.com/64365001/99094377-15655d80-2617-11eb-91d9-a402f41a6b9e.png">

위 과정이 토큰 방식의 흐름이다(출처는 아까와 같습니다)

1. 사용자가 아이디와 비밀번호로 로그인한다.
2. 서버 측에서 해당 정보를 검증한다.
3. 정보가 정확하다면 사용자에게 토큰을 발급한다. 클라이언트는 토큰을 저장해둔다.
4. 클라이언트는 서버에 요청을 할 때마다 해당 토큰을 서버에 함께 보내낸다. 이때 토큰은 http요청 헤더에 토큰을 포함시킨다.
5. 서버는 토큰을 검증해 요청에 응답한다.

### 토큰 인증의 장점

1. 무상태성(Stateless) & 확장성(Scalability) : 토큰은 클라이언트 측에 저장되기 때문에 서버는 완전히 Stateless하며, 클라이언트와 서버의 연결고리가 없기 때문에 확장하기에 매우 적합하다.
2. 보안성 : 클라이언트가 서버로 요청을 보낼 때 더 이상 쿠키를 전달하지 않으므로, 쿠키 사용에 취약점이 사라진다. 토큰 환경의 취약점은 조심해야한다.
3. 확장성(Extensibility) : 시스템 확장과는 달리 로그인 정보가 사용되는 분야의 확장을 의미한다. 토큰 기반 인증 시스템에서는 토큰에 선택적인 권한만 부여하여 발급할 수 있으며 OAuth의 경우 타 회사의 소셜계정을 통해 웹서비스에 로그인한다.
4. 여러 플렛폼 및 도메인 : 애플리케이션과 서비스의 규모가 커지면 여러 디바이스를 호환시키고 더 많은 종류의 서비스를 제공하게 된다. 토큰은 어떤 디바이스 어떤 도메인이든 유효성 검사 후 요청을 처리할 수 있다.

토큰은 주로 **JWT(Json Web Token)** 을 가장 많이 사용한다.

---

